# 仕様

・未ログインはゲストモードとしてセッションストレージにデータ保存する
・ログイン後、フルアクセス

## 多言語対応 (i18n)
・対応言語: `ja`, `en`
・判定: `accept-language` ヘッダと `lang` クッキーを使用
・切替: `/locale/set?lang=ja|en` にアクセスでクッキー設定後、直前のページへリダイレクト
・実装: `middleware.ts` で `x-locale` ヘッダを付与、`LocaleProvider` でクライアントに配信し文言切替

## OGP / Twitter画像
- ルートのOGP画像: `app/opengraph-image.tsx`（1200x630, PNG）
- ルートのTwitter画像: `app/twitter-image.tsx`（1200x630, PNG）
- `app/layout.tsx` の `metadata.openGraph.images` と `metadata.twitter.images` は上記ルートに向けています。


# 画面仕様

## 初回アクセス
(条件)
・アカウント登録前
・トップ画面にアクセス (/)

(挙動)
・サービスの説明がある。
・すぐに使い始められるように、アカウント登録前でも使えるようにする。
  ・セッションストレージにデータ保存
  ・アカウント登録後/ログイン後はセッションローカルデータは削除する。セッションローカルデータと登録後のデータが混ざらないようにする。
    ・ゲストモードでは、3つまでしか動画を登録できない
    ・ログイン後とログイン前でURLパスを分けて明確に分離した方がいい？

・ログイン/アカウント登録/ゲストモード の3つの動線がある。

## ゲストモード
・セッションストレージにデータ登録(動画の登録)されると使用を開始したと判定する。
・使用開始後は、ゲストモードであることをわかりやすく表示する

## Intervals
・パス: `/intervals`
・認証: 不要（誰でもアクセス可）
・目的: ベース演奏中に、理論＝耳＝指板を結びつけるためのリアルタイム度数フィードバックを提供する
・仕様:
  - マイク入力を許可すると、pitchfinder（YIN）で基本周波数を検出
  - 最初に検出された安定した音をルート（R）として自動確定
  - 以降、鳴っている音とルートの半音差を 0..11 に正規化して度数表示（R, b2, 2, b3, 3, 4, b5/#4, 5, b6/#5, 6, b7, 7）
  - 現在音とルートのノート名、周波数、セント差を併記
  - 誤検出時のために「ルートをリセット」操作を提供
・留意点:
  - 検出が不安定な環境（雑音/残響）では度数が揺れることがある
  - 低域〜高域の極端な周波数は無視（おおむね 35Hz〜1kHz を想定）
