# 仕様

・未ログインはゲストモードとしてセッションストレージにデータ保存
・ログイン後はフルアクセス（セッションローカルデータは整理・統合）

## 多言語対応 (i18n)
・対応言語: `ja`, `en`
・判定: `accept-language` と `lang` クッキー（`middleware.ts` で `x-locale` 付与）
・切替: `/locale/set?lang=ja|en` でクッキー設定→直前ページへ戻る

## OGP / Twitter画像
- OGP: `app/opengraph-image.tsx`（1200x630, PNG）
- Twitter: `app/twitter-image.tsx`（1200x630, PNG）
- `app/layout.tsx` で参照設定済み


# 画面仕様（テンプレート準拠）

## /（ホーム／ハブ）
- URL: `/`
- 認証: 不要（誰でもアクセス可）
- 目的: 練習モジュールへの入口。機能理解と最短動線の提供。

- 主要コンテンツ:
  - カード: 
    - コピー練習 `/progress`（動画一覧・追加・個別タイムライン）
    - 音程練習 `/intervals`（リアルタイム度数表示）
    - 度数クイズ `/intervals/quiz`（出題→演奏→判定）
  - サブテキスト: サービス概要（i18n対応）

- 操作/CTA:
  - 各カードクリックで該当モジュールへ遷移
  - ヘッダー右上にアカウント/メニュー（ログイン/ログアウト）

- 状態:
  - デフォルト: 上記3カードを表示
  - 空状態（未利用）: 概要説明＋「ゲストでもすぐ使える」文言
  - ゲスト上限: 動画登録が3件に達したら上限バナーとサインアップ導線

- ゲストモード規約:
  - 3件まで動画登録可（セッションストレージ保存）
  - ログイン後はセッションローカルデータを削除し、サーバ側データと混在させない

- 文言（主要キー）:
  - `hub.subtitle`, `hub.progress.title/desc`, `hub.intervals.title/desc`, `hub.intervals_quiz.title/desc`

- 計測（例）:
  - `page_view`
  - `open_add_dialog`（進捗モジュール内）、`guest_limit_shown`/`guest_limit_login_click` などは各画面で実装

- アクセシビリティ:
  - カード全体をフォーカス可能にし、`focus-visible` のアウトラインを表示
  - 文言は `LocaleProvider` による i18n 切替

- エラー/例外:
  - 重大なエラーなし（静的コンテンツ）。ネットワーク不調時はログイン状態表示のみ影響

- メタデータ:
  - タイトル/説明/OGP は `app/layout.tsx` の `metadata` で定義

## Intervals
・パス: `/intervals`
・認証: 不要（誰でもアクセス可）
・目的: ベース演奏中に、理論＝耳＝指板を結びつけるためのリアルタイム度数フィードバックを提供する
・仕様:
  - マイク入力を許可すると、pitchfinder（YIN）で基本周波数を検出
  - 最初に検出された安定した音をルート（R）として自動確定
  - 以降、鳴っている音とルートの半音差を 0..11 に正規化して度数表示（R, b2, 2, b3, 3, 4, b5/#4, 5, b6/#5, 6, b7, 7）
  - 現在音とルートのノート名、周波数、セント差を併記
  - 誤検出時のために「ルートをリセット」操作を提供
・留意点:
  - 検出が不安定な環境（雑音/残響）では度数が揺れることがある
  - 低域〜高域の極端な周波数は無視（おおむね 35Hz〜1kHz を想定）

## Intervals Quiz（度数クイズ）
・パス: `/intervals/quiz`
・認証: 不要（誰でもアクセス可）
・目的: アプリが出題する「{Root} の {Degree}」に対し、ユーザが弾いた音が正しいか自動判定する
・仕様:
  - マイク入力を許可し、ACF2PLUS で基本周波数を検出（低遅延設定）
  - 出題はルート（12音階のいずれか）と度数（R以外の 1..11 の半音差）をランダムに生成
  - 判定はオクターブ無視（12で剰余）、半音丸め後にルートとの差分が出題度数と一致すれば「正解」
  - 画面に問題文（例: 「C の 3 を弾いてください」）、現在音、判定結果を表示
  - 指板ビューにルート（赤）と現在音（青）を表示
  - 「次の問題」でランダム出題を更新
・留意点:
  - 検出の安定性は環境に依存（雑音・残響）。必要に応じて音量を上げ、弦をしっかり鳴らす
  - 判定は半音単位（セントは参考表示）

## ルーティング構成（モジュール化）
・`/` … ホーム（練習モジュールのハブ）
・`/progress` … YouTube コピー練習モジュール（動画一覧）
  ・`/progress/new` … 動画追加フォーム（URL入力メイン）
  ・`/progress/{videoId}` … 個別動画の練習画面（ブロック進捗タイムライン）
・`/intervals` … 音程練習ハブ
・`/intervals/quiz` … 度数クイズ

（互換）
・既存の `/videos/{videoId}` へアクセスされた場合は `/progress/{videoId}` にリダイレクトする


## デザインの方針
🎨 デザイン改善ポイント（箇条書き）
1. 情報のまとまり（グルーピング）を強化

- コントロールバー（スタート・次へ・デバイス選択・ステータス）を ひとつのカードにまとめる
- 問題表示・判定部分も 独立したカードとして扱う
- Fretboard もカード化し、全体のレイアウトに統一感を持たせる

2. カード UI を活用して視認性アップ

- rounded-2xl, shadow-sm, border-zinc-200 などを使い柔らかく現代的なカードに
- 白背景＋薄いシャドウで 触れやすい UI に

3. 判定部分（correct / wrong）の強調方法を改善

- 文字色だけでなく バッジ（Pill）スタイル を採用

    → 視認性が大幅に向上

4. コントロール類のデザイン統一

- ボタンをすべて 丸みの強い rounded-full スタイル に統一
- hover / active 状態も揃えて触った感じを統一
- ラベル・セレクトは border-zinc-300 + focus:ring で現代的に

5. 現在の音（Hz / セント）の表示を整理

- 小さな情報カード（bg-zinc-50 の軽いパネル）にまとめてノイズを減らす
- NOTE 名だけを太字にして必要な部分を強調

6. 全体の余白バランスを調整

- 上下幅を広げ、読みやすく整理された印象に
- セクション間を mt-5 mt-6 など一定のリズムで区切る

7. ステータスの視覚的フィードバックを追加

- Running のときは緑の小さな点アイコン（status indicator）
    
    → 視覚的に「録音してる」感が伝わる

8. TrackNote の世界観に合わせやすい設計

- 色（アクセントカラー）は後から変えやすい構成

    → ブランドカラーが決まったら差し替え可能
